datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

// Enum for drive mode
enum DriveMode {
  ONLINE
  ONSITE
  HYBRID
  VIDEO
  OTHER
}

enum ApplicationStatus {
  APPLIED
  SHORTLISTED
  REJECTED
  OFFERED
}

model ProformaN {
  id                 Int      @id @default(autoincrement())
  companyName        String
  CompanyCategory    String
  jobRole            String
  profile            String
  Location           String[]
  CTC                Int
  CTCBase            Int
  CTCStocks          Int
  CTCSignOn          Int
  CTCReLoc           Int
  CTCOth             Int
  Internship         String
  Internshipstipend  Int
  DriveMode          String
  cgpaCutoff         Float
  eligibleBatch      String[]
  eligibleBranches   String[] @db.VarChar(191)
  DriveDates         String[]
  round1             String
  round2             String
  round3             String
  round4             String
  Deadline           DateTime
  Spoc               String?
  SpocCont           String
  DescriptionUrl  String? // public URL or signed URL to download the file
  DescriptionKey  String? // storage key / blob id (useful to delete / replace)
  DescriptionName String? // original file name for download / display
  DescriptionSize Int? // optional size in bytes
  DescriptionMime String? // mime-type
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([createdAt])
}

model Student {
  id             String   @id
  instituteEmail String   @unique
  name           String
  branch         String
  degree         String
  batch          Int
  CGPA           Float?
  cgpastudentupdate Boolean @default(false)
  cgpaVerified   Boolean @default(false)
  CV1Url         String? 
  CV1Key         String? 
  CV1Name        String?
  CV2Url         String? 
  CV2Key         String? 
  CV2Name        String?
  CV3Url         String? 
  CV3Key         String? 
  CV3Name        String?
  createdAt      DateTime @default(now())
  InternApply    Boolean @default(false)
  InternOffer    Boolean @default(false)
  FTEApply       Boolean @default(false)
  FTEOffer       Boolean @default(false)

  applications Application[] // âœ… REQUIRED back relation
}

model Application {
  id String @id @default(uuid())

  studentId String
  profileId String

  status    ApplicationStatus @default(APPLIED)
  appliedAt DateTime          @default(now())

  // snapshot data at time of apply
  branchAtApply    String
  degreeAtApply    String
  batchAtApply     Int
  resumeUrlAtApply String?

  remarks String?

  student Student @relation(fields: [studentId], references: [id])

  @@unique([studentId])
}

model Company {
  id String @id @default(uuid())

  name    String
  website String?

  HRName      String
  Designation String
  Email       String

  createdBy String // TPO user id

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model FTEP {
  id        String   @id @default(uuid())
  rollno    String
  name      String
  degree    String
  branch    String
  company   String
  role      String
  year      Int      // placement year (e.g. 2025)
  createdAt DateTime @default(now())
  @@unique([rollno, year])
}
model Intern {
  id        String   @id @default(uuid())
  rollno    String
  name      String
  degree    String
  branch    String
  company   String
  role      String
  year      Int      // placement year (e.g. 2025)
  createdAt DateTime @default(now())
  @@unique([rollno, year])
}